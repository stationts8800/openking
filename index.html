<!DOCTYPE html><html lang="th"><head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</title><!-- ================= LOGIN STYLE ================= --><style>
*{box-sizing:border-box;font-family:Arial, sans-serif;}#loginPage{
position:fixed;
top:0;left:0;
width:100%;
height:100%;
display:flex;
justify-content:center;
align-items:center;
background:linear-gradient(135deg,#ff6600,#ff9966);
z-index:9999;
}

.wrapper{position:relative;}

.logo-float{
position:absolute;
top:-110px;
left:50%;
transform:translate(-50%, 0);
background:transparent;/* ‚úÖ ‡πÄ‡∏≠‡∏≤‡∏ß‡∏á‡∏Ç‡∏≤‡∏ß‡∏≠‡∏≠‡∏Å* /
width:195px;
height:195px;
border-radius:50%;
display:flex;
justify-content:center;
align-items:center;
box-shadow:none;/ ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏°‡∏µ‡πÄ‡∏á‡∏≤‡∏ß‡∏á‡∏Å‡∏•‡∏° */
}

.logo-float img{
width:195px;
height:195px;
border-radius:50%;
object-fit:cover;
}

.container{
background:#fff;
width:380px;
padding:70px 30px 30px;
border-radius:12px;
box-shadow:0 10px 30px rgba(0,0,0,.2);
text-align:center;
}
form{display:none;}
form.active{display:block;}
input{
width:100%;
padding:12px;
margin-bottom:12px;
border:1px solid #ddd;
border-radius:6px;
}
button{
width:100%;
padding:12px;
background:#ff6600;
border:none;
color:#fff;
font-size:16px;
border-radius:6px;
}
.switch span{color:#ff6600;cursor:pointer;font-weight:bold;}
</style><!-- =============== SHOP STYLE ================= --><style>
body{margin:0;font-family:Arial,sans-serif;background:#f5f5f5}
header{background:#ff6600;color:#fff;text-align:center;padding:15px;font-size:20px}
nav{
position:fixed;
bottom:0;
width:100%;
background:#fff;
display:flex;
border-top:1px solid #ddd;
z-index:999;
}

nav button{
flex:1;
padding:10px;
border:none;
background:none;
font-size:12px;
color:#000;/* <<< ‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß */
}

section{display:none;padding:15px;padding-bottom:90px}
section.active{display:block}
.product{background:#fff;border-radius:10px;padding:10px;margin-bottom:12px;box-shadow:0 2px 5px rgba(0,0,0,.1)}
.product img{width:250px;height:250px;object-fit:cover;border-radius:8px;display:block;margin:auto}
.btn{background:#ff6600;color:#fff;border:none;padding:10px;width:100%;border-radius:8px;margin-top:6px;font-size:14px}
input,textarea{width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1px solid #ccc}
.cart-item{background:#fff;padding:10px;margin-bottom:8px;border-radius:8px}
.qr{width:250px;display:block;margin:10px auto}
.fullscreen{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;display:none;justify-content:center;align-items:center;z-index:999}
.fullscreen img{width:100%}
</style></head><body><!-- ================= LOGIN PAGE ================= --><div id="loginPage" style="display:none;">
  <div class="wrapper"> 
<div class="logo-float">
<img id="shopLogo" src="images/logo.png">
</div> 
<div class="container">
<form id="loginForm" class="active" onsubmit="return false;">
<h2>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
<input id="loginUser" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ / ‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
<input id="loginPass" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
<button type="button" onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
<div class="switch">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? <span onclick="showRegister()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span></div>
</form><form id="registerForm" onsubmit="return false;">
<h2>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
<input id="regUser" type="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
<input id="regPass" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
<input id="regConfirm" type="password" placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
<button type="button" onclick="register()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
<div class="switch">‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? <span onclick="showLogin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</span></div>
</form></div>
</div>
</div><!-- ================= SHOP PAGE ================= --><div id="shopPage" style="display:none;"><header>
üõí ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
</header><section id="home" class="active">
<h3>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3>
<div id="productList"></div>
</section><section id="cart">
<h3>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
<div id="cartList"></div>
<p><b>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</b> <span id="totalPrice">0</span> ‡∏ö‡∏≤‡∏ó</p>
<hr>
<h4>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h4>
<div id="myOrderStatus">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</div>
<h4>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö</h4>
<input id="customerName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö">
<input id="phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£">
<textarea id="address" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà"></textarea><button class="btn" onclick="goPayment()">‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button></section>
<section id="payment">
<h3>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
<div id="customerInfo"></div>
<p><b>‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞:</b> <span id="payTotal"></span> ‡∏ö‡∏≤‡∏ó</p>
<hr><p><b>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ:</b> ‡∏ô‡∏≤‡∏¢ ‡∏Å‡∏±‡∏ô‡∏ï‡∏û‡∏á‡∏®‡πå ‡∏ö‡∏∏‡∏ç‡πÄ‡∏à‡∏£‡∏¥‡∏ç</p>
<p><b>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£:</b> ‡πÑ‡∏ó‡∏¢‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå</p>
<p><b>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ:</b> 414-2-12957-8</p>
<img class="qr"
src="https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=4142129578"><button class="btn" onclick="copyAccount()">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button>

<p><b>‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô</b></p>
<input type="file" id="slipFile" accept="image/*"><button class="btn" onclick="uploadSlip()">‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ</button>

<a href="https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=4142129578" download>
<button class="btn">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å QR Code</button>
</a><a href="https://line.me/ti/p/YOUR_LINE_ID">
<button class="btn">üì§ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏•‡∏¥‡∏õ (LINE ‡∏£‡πâ‡∏≤‡∏ô)</button>
</a>
</section><section id="contact">
<h3>‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</h3>
<p>üìû 099-999-9999</p>
<p>üì± LINE: @yourline</p>
</section><nav>
<button onclick="show('home')">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
<button onclick="show('cart')">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
<button onclick="show('payment')">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
<button onclick="show('contact')">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</button>
<button onclick="logout()" style="color:red;font-weight:bold;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
</button>
</nav> </div> <div id="imgView" class="fullscreen" onclick="closeImg()">
<img id="imgFull">
</div>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script><script>
const firebaseConfig = {
apiKey: "AIzaSyD_PEsWuy3Ad7Wfl6V1KmLYUxX_V5MDxto",
authDomain: "openking-shop.firebaseapp.com",
databaseURL: "https://openking-shop-default-rtdb.firebaseio.com",
projectId: "openking-shop",
storageBucket: "openking-shop.firebasestorage.app",
messagingSenderId: "408359377995",     appId: "1:408359377995:web:32f3c2b29a06fa01abc1ce"
};
</script>
<script>
if(!firebase.apps.length){
firebase.initializeApp(firebaseConfig);

}
const auth = firebase.auth();
const db = firebase.database();auth.onAuthStateChanged(user=>{
if(user){

db.ref("users/"+user.uid+"/role")
.once("value")
.then(snapshot=>{

if(snapshot.val()==="user"){

document.getElementById("loginPage").style.display="none";

document.getElementById("loginPage").style.zIndex="-1";
document.getElementById("shopPage").style.display="block";

loadProducts();
loadMyOrder();

}else{
auth.signOut();
}

});

}else{

document.getElementById("loginPage").style.display="flex";
document.getElementById("shopPage").style.display="none";

}
});
</script>

<script>

const loginForm = document.getElementById("loginForm");
const registerForm = document.getElementById("registerForm");

const loginUser = document.getElementById("loginUser");
const loginPass = document.getElementById("loginPass");

const regUser = document.getElementById("regUser");
const regPass = document.getElementById("regPass");
const regConfirm = document.getElementById("regConfirm");

/* ===== ‡∏™‡∏•‡∏±‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° ===== */
function showRegister(){
loginForm.classList.remove("active");
registerForm.classList.add("active");
}

function showLogin(){
registerForm.classList.remove("active");
loginForm.classList.add("active");
}

/* ===== ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ===== */
function register(){

const email = regUser.value.trim();
const pass = regPass.value;
const confirm = regConfirm.value;

if(pass !== confirm){
alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô");
return;
}

auth.createUserWithEmailAndPassword(email, pass)
.then((cred)=>{

db.ref("users/"+cred.user.uid).set({
email: email,
role: "user"
});

alert("‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
showLogin();

})
.catch(err=>{
    alert(err.message);
  });

}

/* ===== ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ===== */
function login(){

const email = loginUser.value.trim();
const pass = loginPass.value.trim();

auth.signInWithEmailAndPassword(email, pass)
  .then((cred)=>{

    db.ref("users/"+cred.user.uid+"/role")
    .once("value")
    .then(snapshot=>{

      if(snapshot.val()==="user"){
       document.getElementById("loginPage").style.display="none";
        document.getElementById("shopPage").style.display="block";
}else{
  alert("‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏î‡πâ");
        auth.signOut();
      }

    });

  })
  .catch(()=>{
    alert("‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏¥‡∏î");
});

}

/* ===== ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö ===== */
    function logout(){
    auth.signOut().then(()=>{
    document.getElementById("loginPage").style.display="flex";
    document.getElementById("shopPage").style.display="none";
  });
}

</script><script>
/* ===== DOM ===== */
const productList=document.getElementById("productList");
const cartList=document.getElementById("cartList");
const totalPrice=document.getElementById("totalPrice");
const customerName=document.getElementById("customerName");
const phone=document.getElementById("phone");
const address=document.getElementById("address");
const customerInfo=document.getElementById("customerInfo");
const payTotal=document.getElementById("payTotal");
const imgView=document.getElementById("imgView");
const imgFull=document.getElementById("imgFull");


let cart=[];
let products = [];

/* ===== ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ===== */
function loadProducts(){

db.ref("products").on("value", snapshot=>{

  products = [];
  let html="";

  snapshot.forEach(child=>{
let stock = parseInt(child.val().stock);
if(isNaN(stock)) stock = 0;

products.push({
  id: child.key,
  name: child.val().name || "",
  scent: child.val().scent || "",
  price: Number(child.val().price) || 0,
  stock: stock,
  img: child.val().img || ""
});
  });

  products.forEach((p,i)=>{

if(p.stock <= 0){
  return; // ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏î
}

    html+=`
    <div class="product">
<img src="${p.img || 'images/noimage.png'}"
          onclick="viewImg('${p.img || 'images/noimage.png'}')">

      <h4>${p.name}</h4>
      <p>‡∏Å‡∏•‡∏¥‡πà‡∏ô: ${p.scent || '-'}</p>
      <p>‡∏£‡∏≤‡∏Ñ‡∏≤: ${p.price} ‡∏ö‡∏≤‡∏ó</p>
      <p>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${p.stock} ‡∏ä‡∏¥‡πâ‡∏ô</p>
      <p>‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß: ${p.stock} ‡∏ä‡∏¥‡πâ‡∏ô</p>
      <input type="number" id="qty${i}" value="1" min="1" max="${p.stock}">
    <button class="btn" onclick="addCart(${i})">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>

<button class="btn" onclick="buyNow(${i})">‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
    </div>
 `;

  });

  productList.innerHTML = html;

});

}

/* ===== ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ ===== */
function addCart(i){

const qty = parseInt(document.getElementById("qty"+i).value);
const stock = parseInt(products[i].stock);

if(qty > stock){
  alert("‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏™‡∏ï‡πä‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏≠");
  return;
}

cart.push({...products[i],qty});
show("cart");
loadCart();

}

function buyNow(i){

const qty = parseInt(document.getElementById("qty"+i).value);
const stock = parseInt(products[i].stock);

if(qty > stock){
  alert("‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏™‡∏ï‡πä‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏≠");
  return;
}

cart.push({...products[i],qty});
show("cart");
loadCart();

}

function loadCart(){
let html="";
let total=0;
cart.forEach(p=>{
const sum = Number(p.price) * Number(p.qty);
total+=sum;
html+=`<div class="cart-item">${p.name} x ${p.qty} = ${sum} ‡∏ö‡∏≤‡∏ó</div>`;
});
cartList.innerHTML=html;
totalPrice.innerText=total;

}

/* ===== ‡πÄ‡∏°‡∏ô‡∏π ===== */
function show(id){
document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
}

/* ===== ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô ===== */
function goPayment(){

const n = customerName.value;
const p = phone.value;
const a = address.value;

if(!n || !p || !a){
alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
  return;
}

if(cart.length==0){
  alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤");
  return;
}

/* ‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î */
let total = 0;
cart.forEach(i=>{
  total += Number(i.price) * Number(i.qty);
});

/* ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå */
let orderRef = db.ref("orders").push();

orderRef.set({
  uid: auth.currentUser.uid,
  customer: n,
  phone: p,
  address: a,
items: cart,
  total: total,
  status: "‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô",
  time: Date.now()
});

/* ‚úÖ ‡∏ï‡∏±‡∏î‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ */
cart.forEach(item=>{

let newStock = item.stock - item.qty;

if(newStock < 0) newStock = 0;

  db.ref("products/"+item.id+"/stock").set(newStock);

});
cart = [];
loadCart();

customerInfo.innerHTML = `
<p>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö: ${n}</p>
<p>‡πÇ‡∏ó‡∏£: ${p}</p>
<p>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${a}</p>
`;

payTotal.innerText = total;
show("payment");
loadMyOrder();
localStorage.setItem("lastOrderId", orderRef.key);

}

/* ===== ‡∏£‡∏π‡∏õ ===== */
function viewImg(src){
imgFull.src=src;
imgView.style.display="flex";
}
function closeImg(){
imgView.style.display="none";
}

/* ===== ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ ===== */
function copyAccount(){
navigator.clipboard.writeText("414-2-12957-8");
alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß");
}
/* ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡∏ô‡∏ó‡∏µ */

function loadMyOrder(){

const user = auth.currentUser;
if(!user) return;

db.ref("orders")
.orderByChild("uid")
.equalTo(user.uid)
.on("value", snapshot=>{

let html="";

snapshot.forEach(child=>{
let o = child.val();
html += `
<div class="card">
<p>‡∏¢‡∏≠‡∏î: ${o.total} ‡∏ö‡∏≤‡∏ó</p>
<p>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <b>${o.status}</b></p>

${
o.status === "‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô"
? `<button onclick="cancelOrder('${child.key}')"
class="btn" style="background:red;">
‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
  </button>`
: ``
 }

</div>
`;
  });

if(html===""){
   html="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå";
  }

document.getElementById("myOrderStatus").innerHTML=html;

});

}

function cancelOrder(orderId){

 if(!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")){
return;
 }

 db.ref("orders/"+orderId).once("value")
 .then(snapshot=>{

let order = snapshot.val();

if(!order) return;

// ‡∏Ñ‡∏∑‡∏ô‡∏™‡∏ï‡πä‡∏≠‡∏Å
order.items.forEach(item=>{

db.ref("products/"+item.id+"/stock")

.once("value")
.then(snap=>{
let current = snap.val() || 0;
db.ref("products/"+item.id+"/stock")
.set(current + item.qty);
});

});

// ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
db.ref("orders/"+orderId+"/status")
.set("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß");

alert("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");

 });

}
console.log("SYSTEM READY");
function uploadSlip(){

const file = document.getElementById("slipFile").files[0];

if(!file){
alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ");
return;
}

let reader = new FileReader();

reader.onload = function(e){

let base64Slip = e.target.result;
let orderId = localStorage.getItem("lastOrderId");

db.ref("orders/"+orderId)
.update({
slip: base64Slip,
status: "‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö"
});

alert("‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");

}

reader.readAsDataURL(file);

}

</script>

<script>
db.ref("shop/logo").on("value", snapshot=>{
if(snapshot.exists()){
document.getElementById("shopLogo").src = snapshot.val();
}
});
</script>

</body>
</html>